{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Wheel.js"],"names":["cc","Class","extends","Component","properties","spinBtn","default","type","Button","visible","displayName","wheelSp","Sprite","maxSpeed","Float","max","min","duration","tooltip","acc","targetID","Integer","springback","effectAudio","url","AudioClip","onLoad","log","wheelState","curSpeed","spinTime","gearNum","defaultAngle","gearAngle","node","rotation","finalAngle","effectFlag","sys","isBrowser","loader","loadRes","err","res","on","Node","EventType","TOUCH_END","event","decAngle","bind","start","caculateFinalAngle","editBoxDidBegin","edit","editBoxDidChanged","text","editBoxDidEndEditing","parseInt","string","isNaN","alert","Math","round","random","update","dt","audioID","audioEngine","playEffect","raw","curRo","hadRo","act","rotateBy","seq","sequence","delayTime","callFunc","showRes","runAction","Config","require","gearInfo"],"mappings":"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","file":"Wheel.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    spinBtn: {\r\n      default: null, // The default value will be used only when the component attachin                    // to a node for the first time\r\n      type: cc.Button, // optional, default is typeof default\r\n      visible: true, // optional, default is true\r\n      displayName: 'SpinBtn' // optional\r\n    },\r\n    wheelSp: {\r\n      default: null,\r\n      type: cc.Sprite\r\n    },\r\n    maxSpeed: {\r\n      default: 5,\r\n      type: cc.Float,\r\n      max: 15,\r\n      min: 2\r\n    },\r\n    duration: {\r\n      default: 3,\r\n      type: cc.Float,\r\n      max: 5,\r\n      min: 1,\r\n      tooltip: '减速前旋转时间'\r\n    },\r\n    acc: {\r\n      default: 0.1,\r\n      type: cc.Float,\r\n      max: 0.2,\r\n      min: 0.01,\r\n      tooltip: '加速度'\r\n    },\r\n    targetID: {\r\n      default: 0,\r\n      type: cc.Integer,\r\n      max: 17,\r\n      min: 0,\r\n      tooltip: '指定结束时的齿轮'\r\n    },\r\n    springback: {\r\n      default: false,\r\n      tooltip: '旋转结束是否回弹'\r\n    },\r\n    effectAudio: {\r\n      default: null,\r\n      url: cc.AudioClip\r\n    }\r\n  },\r\n\r\n  // use this for initialization\r\n  onLoad: function() {\r\n    cc.log('....onload')\r\n    this.wheelState = 0    \r\n    this.curSpeed = 0\r\n    this.spinTime = 0 //减速前旋转时间\r\n    this.gearNum = 18\r\n    this.defaultAngle = 360 / 18 / 2 //修正默认角度\r\n    this.gearAngle = 360 / this.gearNum //每个齿轮的角度\r\n    this.wheelSp.node.rotation = this.defaultAngle\r\n    this.finalAngle = 0 //最终结果指定的角度\r\n    this.effectFlag = 0 //用于音效播放\r\n        \r\n    if (!cc.sys.isBrowser) {\r\n      cc.loader.loadRes('Sound/game_turntable', function(err, res) { if (err) { cc.log('...err:' + err) } })\r\n    }\r\n    this.spinBtn.node.on(cc.Node.EventType.TOUCH_END, function(event) {\r\n      cc.log('begin spin')\r\n      if (this.wheelState !== 0) {\r\n        return\r\n      }\r\n      this.decAngle = 2 * 360 // 减速旋转两圈\r\n      this.wheelState = 1\r\n      this.curSpeed = 0\r\n      this.spinTime = 0\r\n      // var act = cc.rotateTo(10, 360*10);\r\n      // this.wheelSp.node.runAction(act.easing(cc.easeSineInOut()));\r\n    }.bind(this))\r\n  },\r\n\r\n  start: function() {\r\n    // cc.log('....start');\r\n  },\r\n    \r\n  caculateFinalAngle: function(targetID) {\r\n    this.finalAngle = 360 - this.targetID * this.gearAngle + this.defaultAngle\r\n    if (this.springback) {\r\n      this.finalAngle += this.gearAngle\r\n    }\r\n  },\r\n  editBoxDidBegin: function(edit) {\r\n  },\r\n  editBoxDidChanged: function(text) {\r\n  },\r\n  editBoxDidEndEditing: function(edit) {\r\n    var res = parseInt(edit.string)\r\n    if (isNaN(res)) {\r\n      if (cc.sys.isBrowser) {\r\n        alert('please input a number!')\r\n      } else cc.log('.....invalid input')\r\n      this.targetID = Math.round(Math.random() * (this.gearNum - 1))\r\n      return\r\n    }\r\n    this.targetID = res\r\n  },\r\n  // called every frame, uncomment this function to activate update callback\r\n  update: function(dt) {\r\n    if (this.wheelState === 0) {\r\n      return\r\n    }\r\n    // cc.log('......update');\r\n    // cc.log('......state=%d',this.wheelState);\r\n       \r\n    // 播放音效有可能卡\r\n    this.effectFlag += this.curSpeed\r\n    if (!cc.sys.isBrowser && this.effectFlag >= this.gearAngle) {\r\n      if (this.audioID) {\r\n        // cc.audioEngine.pauseEffect(this.audioID);\r\n      }\r\n      // this.audioID = cc.audioEngine.playEffect(this.effectAudio,false);\r\n      this.audioID = cc.audioEngine.playEffect(cc.url.raw('resources/Sound/game_turntable.mp3'))\r\n      this.effectFlag = 0\r\n    }\r\n\r\n    if (this.wheelState == 1) {\r\n      // cc.log('....加速,speed:' + this.curSpeed);\r\n      this.spinTime += dt\r\n      this.wheelSp.node.rotation = this.wheelSp.node.rotation + this.curSpeed\r\n      if (this.curSpeed <= this.maxSpeed) {\r\n        this.curSpeed += this.acc\r\n      } else {\r\n        if (this.spinTime < this.duration) {\r\n          return\r\n        }\r\n        // cc.log('....开始减速');\r\n        //设置目标角度\r\n        this.finalAngle = 360 - this.targetID * this.gearAngle + this.defaultAngle\r\n        this.maxSpeed = this.curSpeed\r\n        if (this.springback) {\r\n          this.finalAngle += this.gearAngle\r\n        }\r\n        this.wheelSp.node.rotation = this.finalAngle\r\n        this.wheelState = 2\r\n      }\r\n    } else if (this.wheelState == 2) {\r\n      // cc.log('......减速');\r\n      var curRo = this.wheelSp.node.rotation //应该等于finalAngle\r\n      var hadRo = curRo - this.finalAngle\r\n      this.curSpeed = this.maxSpeed * ((this.decAngle - hadRo) / this.decAngle) + 0.2 \r\n      this.wheelSp.node.rotation = curRo + this.curSpeed\r\n\r\n      if ((this.decAngle - hadRo) <= 0) {  \r\n        // cc.log('....停止');\r\n        this.wheelState = 0\r\n        this.wheelSp.node.rotation = this.finalAngle\r\n        if (this.springback) {\r\n          // 倒转一个齿轮\r\n          // var act = new cc.rotateBy(0.6, -this.gearAngle);\r\n          var act = cc.rotateBy(0.6, -this.gearAngle)\r\n          var seq = cc.sequence(cc.delayTime(0.2), act, cc.callFunc(this.showRes, this))\r\n          this.wheelSp.node.runAction(seq)\r\n        } else {\r\n          this.showRes()\r\n        }\r\n      }\r\n    }\r\n  },\r\n  showRes: function() {\r\n    var Config = require('Config')\r\n    if (cc.sys.isBrowser) {\r\n    //   alert('You have got ' + Config.gearInfo[this.targetID])\r\n      cc.log(Config.gearInfo[this.targetID])\r\n    } else cc.log(Config.gearInfo[this.targetID])\r\n  }\r\n})\r\n"]}